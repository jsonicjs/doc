!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).JsonicDoc=e()}}((function(){var e,t,n,r=e={};function i(){throw new Error("setTimeout has not been defined")}function o(){throw new Error("clearTimeout has not been defined")}function l(e){if(t===setTimeout)return setTimeout(e,0);if((t===i||!t)&&setTimeout)return t=setTimeout,setTimeout(e,0);try{return t(e,0)}catch(n){try{return t.call(null,e,0)}catch(n){return t.call(this,e,0)}}}!function(){try{t="function"==typeof setTimeout?setTimeout:i}catch(e){t=i}try{n="function"==typeof clearTimeout?clearTimeout:o}catch(e){n=o}}();var s,a=[],u=!1,c=-1;function h(){u&&s&&(u=!1,s.length?a=s.concat(a):c=-1,a.length&&f())}function f(){if(!u){var e=l(h);u=!0;for(var t=a.length;t;){for(s=a,a=[];++c<t;)s&&s[c].run();c=-1,t=a.length}s=null,u=!1,function(e){if(n===clearTimeout)return clearTimeout(e);if((n===o||!n)&&clearTimeout)return n=clearTimeout,clearTimeout(e);try{n(e)}catch(t){try{return n.call(null,e)}catch(t){return n.call(this,e)}}}(e)}}function d(e,t){this.fun=e,this.array=t}function p(){}r.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];a.push(new d(e,t)),1!==a.length||u||l(f)},d.prototype.run=function(){this.fun.apply(null,this.array)},r.title="browser",r.browser=!0,r.env={},r.argv=[],r.version="",r.versions={},r.on=p,r.addListener=p,r.once=p,r.off=p,r.removeListener=p,r.removeAllListeners=p,r.emit=p,r.prependListener=p,r.prependOnceListener=p,r.listeners=function(e){return[]},r.binding=function(e){throw new Error("process.binding is not supported")},r.cwd=function(){return"/"},r.chdir=function(e){throw new Error("process.chdir is not supported")},r.umask=function(){return 0};var v={};(function(e){(function(){"use strict";function t(e){if("string"!=typeof e)throw new TypeError("Path must be a string. Received "+JSON.stringify(e))}function n(e,t){for(var n,r="",i=0,o=-1,l=0,s=0;s<=e.length;++s){if(s<e.length)n=e.charCodeAt(s);else{if(47===n)break;n=47}if(47===n){if(o===s-1||1===l);else if(o!==s-1&&2===l){if(r.length<2||2!==i||46!==r.charCodeAt(r.length-1)||46!==r.charCodeAt(r.length-2))if(r.length>2){var a=r.lastIndexOf("/");if(a!==r.length-1){-1===a?(r="",i=0):i=(r=r.slice(0,a)).length-1-r.lastIndexOf("/"),o=s,l=0;continue}}else if(2===r.length||1===r.length){r="",i=0,o=s,l=0;continue}t&&(r.length>0?r+="/..":r="..",i=2)}else r.length>0?r+="/"+e.slice(o+1,s):r=e.slice(o+1,s),i=s-o-1;o=s,l=0}else 46===n&&-1!==l?++l:l=-1}return r}var r={resolve:function(){for(var r,i="",o=!1,l=arguments.length-1;l>=-1&&!o;l--){var s;l>=0?s=arguments[l]:(void 0===r&&(r=e.cwd()),s=r),t(s),0!==s.length&&(i=s+"/"+i,o=47===s.charCodeAt(0))}return i=n(i,!o),o?i.length>0?"/"+i:"/":i.length>0?i:"."},normalize:function(e){if(t(e),0===e.length)return".";var r=47===e.charCodeAt(0),i=47===e.charCodeAt(e.length-1);return 0!==(e=n(e,!r)).length||r||(e="."),e.length>0&&i&&(e+="/"),r?"/"+e:e},isAbsolute:function(e){return t(e),e.length>0&&47===e.charCodeAt(0)},join:function(){if(0===arguments.length)return".";for(var e,n=0;n<arguments.length;++n){var i=arguments[n];t(i),i.length>0&&(void 0===e?e=i:e+="/"+i)}return void 0===e?".":r.normalize(e)},relative:function(e,n){if(t(e),t(n),e===n)return"";if((e=r.resolve(e))===(n=r.resolve(n)))return"";for(var i=1;i<e.length&&47===e.charCodeAt(i);++i);for(var o=e.length,l=o-i,s=1;s<n.length&&47===n.charCodeAt(s);++s);for(var a=n.length-s,u=l<a?l:a,c=-1,h=0;h<=u;++h){if(h===u){if(a>u){if(47===n.charCodeAt(s+h))return n.slice(s+h+1);if(0===h)return n.slice(s+h)}else l>u&&(47===e.charCodeAt(i+h)?c=h:0===h&&(c=0));break}var f=e.charCodeAt(i+h);if(f!==n.charCodeAt(s+h))break;47===f&&(c=h)}var d="";for(h=i+c+1;h<=o;++h)h!==o&&47!==e.charCodeAt(h)||(0===d.length?d+="..":d+="/..");return d.length>0?d+n.slice(s+c):(s+=c,47===n.charCodeAt(s)&&++s,n.slice(s))},_makeLong:function(e){return e},dirname:function(e){if(t(e),0===e.length)return".";for(var n=e.charCodeAt(0),r=47===n,i=-1,o=!0,l=e.length-1;l>=1;--l)if(47===(n=e.charCodeAt(l))){if(!o){i=l;break}}else o=!1;return-1===i?r?"/":".":r&&1===i?"//":e.slice(0,i)},basename:function(e,n){if(void 0!==n&&"string"!=typeof n)throw new TypeError('"ext" argument must be a string');t(e);var r,i=0,o=-1,l=!0;if(void 0!==n&&n.length>0&&n.length<=e.length){if(n.length===e.length&&n===e)return"";var s=n.length-1,a=-1;for(r=e.length-1;r>=0;--r){var u=e.charCodeAt(r);if(47===u){if(!l){i=r+1;break}}else-1===a&&(l=!1,a=r+1),s>=0&&(u===n.charCodeAt(s)?-1==--s&&(o=r):(s=-1,o=a))}return i===o?o=a:-1===o&&(o=e.length),e.slice(i,o)}for(r=e.length-1;r>=0;--r)if(47===e.charCodeAt(r)){if(!l){i=r+1;break}}else-1===o&&(l=!1,o=r+1);return-1===o?"":e.slice(i,o)},extname:function(e){t(e);for(var n=-1,r=0,i=-1,o=!0,l=0,s=e.length-1;s>=0;--s){var a=e.charCodeAt(s);if(47!==a)-1===i&&(o=!1,i=s+1),46===a?-1===n?n=s:1!==l&&(l=1):-1!==n&&(l=-1);else if(!o){r=s+1;break}}return-1===n||-1===i||0===l||1===l&&n===i-1&&n===r+1?"":e.slice(n,i)},format:function(e){if(null===e||"object"!=typeof e)throw new TypeError('The "pathObject" argument must be of type Object. Received type '+typeof e);return function(e,t){var n=t.dir||t.root,r=t.base||(t.name||"")+(t.ext||"");return n?n===t.root?n+r:n+"/"+r:r}(0,e)},parse:function(e){t(e);var n={root:"",dir:"",base:"",ext:"",name:""};if(0===e.length)return n;var r,i=e.charCodeAt(0),o=47===i;o?(n.root="/",r=1):r=0;for(var l=-1,s=0,a=-1,u=!0,c=e.length-1,h=0;c>=r;--c)if(47!==(i=e.charCodeAt(c)))-1===a&&(u=!1,a=c+1),46===i?-1===l?l=c:1!==h&&(h=1):-1!==l&&(h=-1);else if(!u){s=c+1;break}return-1===l||-1===a||0===h||1===h&&l===a-1&&l===s+1?-1!==a&&(n.base=n.name=0===s&&o?e.slice(1,a):e.slice(s,a)):(0===s&&o?(n.name=e.slice(1,l),n.base=e.slice(1,a)):(n.name=e.slice(s,l),n.base=e.slice(s,a)),n.ext=e.slice(l,a)),s>0?n.dir=e.slice(0,s-1):o&&(n.dir="/"),n},sep:"/",delimiter:":",win32:null,posix:null};r.posix=r,v=r}).call(this)}).call(this,e);var g={exports:{}};(function(e){(function(){!function(t){"object"==typeof g.exports?g.exports=t():("undefined"!=typeof window?window:void 0!==e?e:"undefined"!=typeof self?self:this).Gubu=t()}((function(){var e={},t={};Object.defineProperty(t,"__esModule",{value:!0}),t.Gubu=void 0;const n=Symbol.for("gubu$"),r={gubu$:n,v$:"8.3.0"},i=/^[A-Z]/,{toString:o}=Object.prototype,l="name",s="never",a="number",u="required",c="array",h="function",f="object",d="string",p="undefined",v="any",g="list",y="instance",m="null",b="type",$="closed",k="check",x="regexp",w="String",I="Number",A="Boolean",j="Object",S="Array",O="Function",N="Value",C="Below",T="Check",V="Child",E="Exact",R="Open",_="Some",D=" for property ",M='"$PATH"',G='"$VALUE"',L={[w]:String,[I]:Number,[A]:Boolean,[j]:Object,[S]:Array,Symbol:Symbol,[O]:Function},P=e=>Object.keys(e),J=(e,t,n)=>Object.defineProperty(e,t,n),W=e=>Array.isArray(e),B=e=>JSON.parse(e),F=(e,t)=>JSON.stringify(e,t);class z{constructor(e,t,n,r){this.match=!1,this.dI=0,this.nI=2,this.cI=-1,this.pI=0,this.sI=-1,this.valType=s,this.isRoot=!1,this.key="",this.type=s,this.stop=!0,this.nextSibling=!0,this.fromDflt=!1,this.ignoreVal=void 0,this.curerr=[],this.err=[],this.parents=[],this.keys=[],this.ancestors=[],this.path=[],this.root=e,this.vals=[e,-1],this.node=t,this.nodes=[t,-1],this.ctx=n||{},this.match=!!r}next(){this.stop=!1,this.fromDflt=!1,this.ignoreVal=void 0,this.isRoot=0===this.pI,this.check=void 0;let e=this.nodes[this.pI];for(this.ancestors[this.dI]=this.node;+e;)this.dI--,this.ctx.log&&-1<this.dI&&this.ctx.log("e"+(W(this.parents[this.pI])?"a":"o"),this),this.pI=+e,e=this.nodes[this.pI];e?(this.node=e,this.updateVal(this.vals[this.pI]),this.key=this.keys[this.pI],this.cI=this.pI,this.sI=this.pI+1,Object.isFrozen(this.parents[this.pI])&&(this.parents[this.pI]={...this.parents[this.pI]}),this.parent=this.parents[this.pI],this.nextSibling=!0,this.type=this.node.t,this.path[this.dI]=this.key,this.oval=this.val,this.curerr.length=0):this.stop=!0}updateVal(e){this.val=e,this.valType=typeof this.val,a===this.valType&&isNaN(this.val)&&(this.valType="nan"),this.isRoot&&!this.match&&(this.root=this.val)}}class U extends TypeError{constructor(e,t,n,r){var i;super((t=null==t||t.startsWith("G$")?"":t+": ")+n.map(e=>e.text).join("\n")),this.gubu=!0,this.name="GubuError",this.code=e,this.gname=t,this.desc=()=>({name:"GubuError",code:e,err:n,ctx:r}),this.stack=null===(i=this.stack)||void 0===i?void 0:i.replace(/.*\/gubu\/gubu\.[tj]s.*\n/g,""),this.props=n.map(e=>{var t;return{path:e.path,what:e.why,type:null===(t=e.node)||void 0===t?void 0:t.t,value:e.value}})}toJSON(){return{...this,err:this.desc().err,name:this.name,message:this.message}}}const q={Array:!0,BigInt:!0,Boolean:!0,Function:!0,Number:!0,Object:!0,String:!0,Symbol:!0},H={string:"",number:0,boolean:!1,object:{},array:[],symbol:Symbol(""),bigint:BigInt(0),null:null,regexp:/.*/};function K(e,t,l){var s,u,g,b;if(Q===e)e=void 0;else if(null!=e&&(null===(s=e.$)||void 0===s?void 0:s.gubu$)){if(n===e.$.gubu$)return e.d=null==t?e.d:t,e;if(!0===e.$.gubu$){let r={...e};return r.$={v$:"8.3.0",...r.$,gubu$:n},r.v=null!=r.v&&f===typeof r.v?{...r.v}:r.v,r.t=r.t||typeof r.v,h===r.t&&q[r.v.name]&&(r.t=r.v.name.toLowerCase(),r.v=Ee(H[r.t]),r.f=r.v),r.r=!!r.r,r.p=!!r.p,r.d=null==t?null==r.d?-1:r.d:t,r.b=r.b||[],r.a=r.a||[],r.u=r.u||{},r.m=r.m||l||{},r}}let $=null===e?m:typeof e;$=p===$?v:$;let k,w=e,I=w,A=!1,S={},N=[],C=[];if(f===$)I=void 0,W(w)?($=c,1===w.length&&(k=w[0],w=[])):null!=w&&Function!==w.constructor&&Object!==w.constructor&&null!=w.constructor?("[object RegExp]"===o.call(w)?($=x,A=!0):($=y,S.n=w.constructor.name,S.i=w.constructor),I=w):0===P(w).length&&(k=ie());else if(h===$)if(q[e.name])$=e.name.toLowerCase(),A=!0,w=Ee(H[$]),I=w,j===e.name&&(k=ie());else if(w.gubu===r||!0===(null===(u=w.$)||void 0===u?void 0:u.gubu)){let e=w.node?w.node():w;$=e.t,w=e.v,I=w,A=e.r,S={...e.u},N=[...e.a],C=[...e.b]}else O===w.constructor.name&&i.test(w.name)&&($=y,A=!0,S.n=null===(b=null===(g=w.prototype)||void 0===g?void 0:g.constructor)||void 0===b?void 0:b.name,S.i=w);else a===$&&isNaN(w)?$="nan":d===$&&""===w&&(S.empty=!0);let T=null==w||f!==$&&c!==$?w:{...w};return{$:r,t:$,v:T,f:I,n:null!=T&&f===typeof T?P(T).length:0,c:k,r:A,p:!1,d:null==t?-1:t,k:[],e:!0,u:S,a:N,b:C,m:l||{},[Symbol.for("nodejs.util.inspect.custom")](){const e={...this};return delete e.$,JSON.stringify(e,(e,t)=>"function"!=typeof t||Re[t.name]?t:t.name).replace(/"/g,"").replace(/,/g," ")}}}function Z(e,t){var n;const r=[[{},"root",e,t]];for(let i=0;i<r.length;i++){const e=r[i],t=e[0][e[1]]=K(e[2],e[3]);void 0!==t.c&&((null===(n=t.c.$)||void 0===n?void 0:n.gubu$)||r.push([t,"c",t.c,t.d]));let o=typeof t.v;f===o&&null!=t.v&&Object.entries(t.v).map(e=>{var n;(null===(n=e[1].$)||void 0===n?void 0:n.gubu$)||r.push([t.v,e[0],e[1],t.d+1])})}return r[0][0].root}function Q(t,i){const o=null==i?{}:i;o.name=null==o.name?"G$"+(""+Math.random()).substring(2,8):""+o.name;let l=o.meta=o.meta||{};l.active=!0===l.active||!1,l.suffix=d==typeof l.suffix?l.suffix:"$$";let a=o.keyexpr=o.keyexpr||{};a.active=!1!==a.active;let h=o.valexpr=o.valexpr||{};h.active=!0===h.active,h.keymark=d==typeof h.keymark?h.keymark:l.suffix;let w,I=K(t,0),A="";function j(e,t,n){var r,i,w;const A=null===(r=null==t?void 0:t.skip)||void 0===r?void 0:r.depth,j=Array.isArray(null===(i=null==t?void 0:t.skip)||void 0===i?void 0:i.depth)?t.skip.depth:null,S=Array.isArray(null===(w=null==t?void 0:t.skip)||void 0===w?void 0:w.keys)?t.skip.keys:null,O=new z(e,I,t,n);for(;O.next(),!O.stop;){let t=O.node,n=!1,r=!1,i=!!(t.d===A||j&&j.includes(t.d)||S&&1===t.d&&S.includes(O.key))||t.p;if(0<t.b.length)for(let e=0;e<t.b.length;e++){let i=Y(t.b[e],O);t=O.node,void 0!==i.done&&(n=i.done),r=r||!!i.fatal}if(!n){let n=!0,r=void 0===O.val;if(s===O.type)O.curerr.push(Ce(s,O,1070));else if(f===O.type){let e;if(void 0!==t.c&&(t.c=Z(t.c,1+O.dI)),t.r&&r?(O.ignoreVal=!0,O.curerr.push(Ce(u,O,1010))):r||null!==O.val&&f===O.valType&&!W(O.val)?!i&&r&&void 0!==t.f?(O.updateVal(t.f),O.fromDflt=!0,e=O.val,n=!1):i&&r||(O.updateVal(O.val||(O.fromDflt=!0,{})),e=O.val):(O.curerr.push(Ce(b,O,1020)),e=W(O.val)?O.val:{}),n&&(e=null==e&&!1===O.ctx.err?{}:e,null!=e)){O.ctx.log&&O.ctx.log("so",O);let n=!1,r=P(t.v),i=O.nI;if(0<r.length){n=!0,O.pI=i;for(let n=0;n<r.length;n++){let i,o=r[n];if(l.active&&o.endsWith(l.suffix)){if(i={short:""},d===typeof t.v[o]?i.short=t.v[o]:i={...i,...t.v[o]},delete t.v[o],n++,r.length<=n)break;if(r[n]!==o.substring(0,o.length-l.suffix.length))throw new Error("Invalid meta key: "+o);o=r[n]}let s=o,u=t.v[o];if(a.active){let e=/^\s*("(\\.|[^"\\])*"|[^\s]+):\s*(.*?)\s*$/.exec(o);e&&(s=e[1],u=X({src:e[3],d:1+O.dI,meta:i},u),delete t.v[o])}if(h.active&&o.startsWith(h.keymark)){if(o===h.keymark){let e=X({src:u,d:1+O.dI,meta:i,ancestors:O.ancestors,node:t},t);Object.assign(t,e)}else t.m.$$=t.m.$$||{},t.m.$$[o.substring(h.keymark.length)]=t.v[o];delete t.v[o];continue}let c=K(u,1+O.dI,i);t.v[s]=c,t.k.includes(s)||t.k.push(s),O.nodes[O.nI]=c,O.vals[O.nI]=e[s],O.parents[O.nI]=e,O.keys[O.nI]=s,O.nI++}}let o=P(e).filter(e=>void 0===t.v[e]);if(0<o.length)if(void 0===t.c)O.ignoreVal=!0,O.curerr.push(Ce($,O,1100,void 0,{k:o}));else{n=!0,O.pI=i;for(let n of o){let r=t.c=K(t.c,1+O.dI);O.nodes[O.nI]=r,O.vals[O.nI]=e[n],O.parents[O.nI]=e,O.keys[O.nI]=n,O.nI++}}n?(O.dI++,O.nodes[O.nI]=O.sI,O.parents[O.nI]=e,O.nextSibling=!1,O.nI++):O.ctx.log&&O.ctx.log("eo",O)}}else if(c===O.type)if(t.r&&r)O.ignoreVal=!0,O.curerr.push(Ce(u,O,1030));else if(r||W(O.val)){if(!i&&r&&void 0!==t.f)O.updateVal(t.f),O.fromDflt=!0;else if(!i||null!=O.val){O.updateVal(O.val||(O.fromDflt=!0,[]));let n=void 0!==t.c,r=0<O.val.length,i=P(t.v).filter(e=>!isNaN(+e)),o=0<i.length;if(n&&(t.c=Z(t.c,1+O.dI)),O.ctx.log&&O.ctx.log("sa",O),r||o){O.pI=O.nI;let e=0;if(o)if(i.length<O.val.length&&!n)O.ignoreVal=!0,O.curerr.push(Ce($,O,1090,void 0,{k:i.length}));else for(;e<i.length;e++){let n=t.v[e]=K(t.v[e],1+O.dI);O.nodes[O.nI]=n,O.vals[O.nI]=O.val[e],O.parents[O.nI]=O.val,O.keys[O.nI]=""+e,O.nI++}if(n&&r){let n=t.c;for(;e<O.val.length;e++)O.nodes[O.nI]=n,O.vals[O.nI]=O.val[e],O.parents[O.nI]=O.val,O.keys[O.nI]=""+e,O.nI++}O.ignoreVal||(O.dI++,O.nodes[O.nI]=O.sI,O.parents[O.nI]=O.val,O.nextSibling=!1,O.nI++)}else O.ctx.log&&n&&null==e&&O.ctx.log("kv",{...O,key:0,val:t.c}),O.ctx.log&&O.ctx.log("ea",O)}}else O.curerr.push(Ce(b,O,1040));else if(x===O.type)r&&!t.r?O.ignoreVal=!0:d!==O.valType?(O.ignoreVal=!0,O.curerr.push(Ce(b,O,1045))):O.val.match(t.v)||(O.ignoreVal=!0,O.curerr.push(Ce(x,O,1045)));else if(v===O.type||g===O.type||k===O.type||void 0===O.val||O.type===O.valType||y===O.type&&t.u.i&&O.val instanceof t.u.i||m===O.type&&null===O.val)if(void 0===O.val){let e=O.path[O.dI];i||!t.r||p===O.type&&O.parent.hasOwnProperty(e)?void 0!==t.f&&!i||p===O.type?(O.updateVal(t.f),O.fromDflt=!0):v===O.type&&(O.ignoreVal=void 0===O.ignoreVal||O.ignoreVal):(O.ignoreVal=!0,O.curerr.push(Ce(u,O,1060))),O.ctx.log&&O.ctx.log("kv",O)}else d!==O.type||""!==O.val||t.u.empty||O.curerr.push(Ce(u,O,1080)),O.ctx.log&&O.ctx.log("kv",O);else O.curerr.push(Ce(b,O,1050))}if(0<t.a.length)for(let e=0;e<t.a.length;e++){let i=Y(t.a[e],O);t=O.node,void 0!==i.done&&(n=i.done),r=r||!!i.fatal}let o=i?!1!==O.ignoreVal:!!O.ignoreVal;!O.match&&null!=O.parent&&!n&&!o&&(O.parent[O.key]=O.val),O.nextSibling&&(O.pI=O.sI),(O.node.e||r)&&O.err.push(...O.curerr)}if(0<O.err.length)if(W(O.ctx.err))O.ctx.err.push(...O.err);else if(!O.match&&!1!==O.ctx.err)throw new U("shape",o.name,O.err,O.ctx);return O.match?0===O.err.length:O.root}function S(e,t){return j(e,t,!1)}return S.valid=function(e,t){let n=t||{};return n.err=n.err||[],j(e,n,!1),0===n.err.length},S.match=(e,t)=>j(e,t=t||{},!0),S.error=(e,t)=>{let n=t||{};return n.err=n.err||[],j(e,n,!1),n.err},S.spec=()=>{S(void 0,{err:!1});const e=Ve(I,(e,t)=>n===t||t,!1,!0);return B(e)},S.node=()=>(S.spec(),I),S.stringify=(...e)=>{const t=S.jsonify();return""===A?A="string"==typeof t?t.replace(/^"(.*)"$/,"$1"):JSON.stringify(t,...e):A},S.jsonify=()=>null==w?w=Te(S.node()):w,S.toString=()=>(A=te(""===A?Ve(null==I||!I.$||n!==I.$.gubu$&&!0!==I.$.gubu$?I:I.v,null,!0):A),`[Gubu ${o.name} ${A}]`),e.inspect&&e.inspect.custom&&(S[e.inspect.custom]=S.toString),S.gubu=r,S.spec(),S}function X(e,t){var n,r;let i,o=!1;"string"==typeof e&&(e={src:e}),e.keymark=e.keymark||"$$";const l=null===(n=null==t?void 0:t.$)||void 0===n?void 0:n.gubu$;if(e.i=e.i||0,null==e.tokens){i=null!=e.val?K(e.val,(e.d||0)+1,e.meta):void 0,o=!0,e.tokens=[];let n=/\s*,?\s*([)(\.]|"(\\.|[^"\\])*"|\/(\\.|[^\/\\])*\/[a-z]?|[^)(,.\s]+)\s*/g,r=null;for(;r=n.exec(e.src);)e.tokens.push(r[1]);if(!l){let n=0,r=!1;for(;n<e.tokens.length;n++)if(")"==e.tokens[n]){r=!0;break}if((r||n===e.tokens.length)&&void 0!==t){let i="token_"+e.d+"_"+e.i;e.refs=e.refs||{},e.refs[i]=t,r?e.tokens.splice(n,0,e.keymark+i):e.tokens.push("(",e.keymark+i,")")}}}let s=e.tokens[e.i],u=Re[s];if(")"===e.tokens[e.i])return e.i++,t;e.i++;let c=[];if(null==u)try{let t;if(L[s])u=ke,c.unshift(s);else{if(p===s)return;if("NaN"===s)return NaN;if(s.match(/^\/.+\/$/))return new RegExp(s.substring(1,s.length-1));if(t=s.match(/^\$\$([^$]+)$/))return e.node?((null===(r=e.node.m)||void 0===r?void 0:r.$$)||{})[t[1]]||e.node.v["$$"+t[1]]:e.refs?e.refs[t[1]]:void 0;{let e=B(s);if(!o)return e;u=ae,c.unshift(e)}}}catch(a){throw new SyntaxError(`Gubu: unexpected token ${s} in builder expression ${e.src}`)}if("("===e.tokens[e.i]){e.i++;let t=null;for(;null!=(t=e.tokens[e.i])&&")"!==t;){let t=X(e);c.push(t)}e.i++}return i=l?u.call(t,...c):u.call(void 0,...c),"."===e.tokens[e.i]?(e.i++,i=X(e,i)):o&&e.i<e.tokens.length&&(i=X(e,i)),i}function Y(e,t){var n;let r,i={},o=!1;try{o=!(void 0!==t.val||!(null===(n=e.gubu$)||void 0===n?void 0:n.Check))||(t.check=e,e(t.val,i,t))}catch(l){r=l}let s=W(i.err)?0<i.err.length:null!=i.err;if(!o||s){if(void 0===t.val&&(t.node.p||!t.node.r)&&!0!==i.done)return delete i.err,i;let n=i.why||k,o=ee(t);if(d===typeof i.err)t.curerr.push(Ne(t,i.err));else if(f===typeof i.err)t.curerr.push(...[i.err].flat().filter(e=>null!=e).map(e=>(e.path=null==e.path?o:e.path,e.mark=null==e.mark?2010:e.mark,e)));else{let i=e.name;null!=i&&""!=i||(i=te(e.toString().replace(/[ \t\r\n]+/g," "))),t.curerr.push(Ce(n,t,1045,void 0,{thrown:r},i))}i.done=null==i.done||i.done}return i.hasOwnProperty("uval")?(t.updateVal(i.uval),t.ignoreVal=!1):void 0===i.val||Number.isNaN(i.val)||(t.updateVal(i.val),t.ignoreVal=!1),void 0!==i.node&&(t.node=i.node),void 0!==i.type&&(t.type=i.type),i}function ee(e){return e.path.slice(1,e.dI+1).filter(e=>null!=e).join(".")}function te(e,t){let n=String(e),r=null==t||isNaN(t)?30:t<0?0:~~t,i=null==e?0:n.length,o=null==e?"":n.substring(0,i);return o=r<i?o.substring(0,r-3)+"...":o,o.substring(0,r)}const ne=function(e){var t;let n=Oe(this,e);return n.r=!0,n.p=!1,void 0===e?(n.f=void 0,1===arguments.length&&(n.t=p,n.v=void 0)):(null===(t=null==this?void 0:this.$)||void 0===t?void 0:t.gubu$)&&(n.f=void 0),n},re=function(e){let t=Oe(this,e);return t.c=ie(),t},ie=function(e){let t=Oe(this,e);return t.t=v,void 0!==e&&(t.v=e,t.f=e),t},oe=function(e,t){let n=Oe(this,t);return n.z=e,n},le=function(e){let t=Oe(this,e);return t.r=!1,t.p=!0,t},se=function(e){let t=Oe(this,e);return t.r=!1,t.p=!0,t.e=!1,t.a.push((function(e,t,n){return 0<n.curerr.length&&(t.uval=void 0,t.done=!1),!0})),t},ae=function(e,t){let n=Oe(this,e);if(void 0!==t&&(n=Oe(n,t)),n.r=!1,n.f=e,void 0===t)h===typeof e&&q[e.name]&&(n.t=e.name.toLowerCase(),n.f=Ee(H[n.t]));else{const e=K(t);n.t=e.t}return n.p=!1,n},ue=function(e){let t=Oe(this,e);return t.u.empty=!0,t},ce=function(e){let t=Oe(this,e);return t.t=s,t},he=function(...e){const t=Oe(this),n=function(t,n,r){for(let i=0;i<e.length;i++)if(t===e[i])return!0;if(r.node.hasOwnProperty("f")&&void 0===t){const t=r.node.f;for(let n=0;n<e.length;n++)if(t===e[n])return!0}return n.err=Ne(r,N+" "+G+D+M+" must be exactly one of: "+e.map(e=>Ve(e,null,!0)).join(", ")),n.done=!0,!1};return n.n=E,n.a=e,n.s=()=>E+"("+e.map(e=>Ve(e,null,!0)).join(",")+")",t.b.push(n),t},fe=function(e,t){let n=Oe(this,t);return n.b.push(e),n},de=function(e,t){let n=Oe(this,t);return n.a.push(e),n},pe=function(e,t){let n=Oe(this,t);if(n.r=!0,h===typeof e){let t=e;t.gubu$=t.gubu$||{},t.gubu$.Check=!0,t.s=()=>T+"("+Ve(e,null,!0)+")",n.b.push(e),n.t=k}else if(f===typeof e){if(Object.prototype.toString.call(e).includes("RegExp")){let t=t=>null!=t&&!Number.isNaN(t)&&!!String(t).match(e);J(t,l,{value:String(e)}),J(t,"gubu$",{value:{Check:!0}}),t.s=()=>T+"("+Ve(e,null,!0)+")",n.b.push(t),n.t=k}}else d===typeof e&&(n.t=e);if(void 0!==t){const e=K(t);n.t=e.t}return n},ve=function(e){let t=Oe(this,e);return c===t.t&&void 0!==t.c&&0===t.n&&(t.v=[t.c]),t.c=void 0,t},ge=function(e,t){let n=Oe(this,t),r=d===typeof e?e:(f===typeof e&&e||{}).name;return null!=r&&""!=r&&n.b.push((function(e,t,n){return(n.ctx.ref=n.ctx.ref||{})[r]=n.node,!0})),n},ye=function(e,t){let n=Oe(this,t),r=f===typeof e&&e||{},i=d===typeof e?e:r.name,o=!!r.fill;return null!=i&&""!=i&&n.b.push((function(e,t,n){if(void 0!==e||o){let e=n.ctx.ref=n.ctx.ref||{};if(void 0!==e[i]){let n={...e[i]};n.t=n.t||s,t.node=n,t.type=n.t}}return!0})),n},me=function(e,t){let n=Oe(this,t),r=f===typeof e&&e||{},i=d===typeof e?e:r.name,o="boolean"==typeof r.keep?r.keep:void 0,s=W(r.claim)?r.claim:[];if(null!=i&&""!=i){let e=(e,t,n)=>{if(void 0===e&&0<s.length){n.ctx.Rename=n.ctx.Rename||{},n.ctx.Rename.fromDflt=n.ctx.Rename.fromDflt||{};for(let e of s){let r=n.ctx.Rename.fromDflt[e]||{};if(void 0!==n.parent[e]&&!r.yes){t.val=n.parent[e],n.match||(n.parent[i]=t.val),t.node=r.node;for(let e=0;e<n.err.length;e++)n.err[e].k===r.key&&(n.err.splice(e,1),e--);if(o){let t=n.cI+1;n.nodes.splice(t,0,K(r.dval)),n.vals.splice(t,0,void 0),n.parents.splice(t,0,n.parent),n.keys.splice(t,0,e),n.nI++,n.pI++}else delete n.parent[e];break}}void 0===t.val&&(t.val=n.node.v)}return!0};J(e,l,{value:"Rename:"+i}),n.b.push(e);let t=(e,t,n)=>(n.parent[i]=e,n.match||o||n.key===i||W(n.parent)&&!1!==o||(delete n.parent[n.key],t.done=!0),n.ctx.Rename=n.ctx.Rename||{},n.ctx.Rename.fromDflt=n.ctx.Rename.fromDflt||{},n.ctx.Rename.fromDflt[i]={yes:n.fromDflt,key:n.key,dval:n.node.v,node:n.node},!0);J(t,l,{value:"Rename:"+i}),n.a.push(t)}return n},be=function(e,t){let n=Oe(this,t);return n.c=K(e),void 0===n.v&&(n.t="object",n.v={},n.f={}),n},$e=function(e,t){let n=Oe(this,t||[]);return n.t="array",n.c=K(e),n.m=n.m||{},n.m.rest=!0,n},ke=function(e,t){let n=K(L[e]),r=Oe(this,t);return r!==n&&(r.t=n.t,r.r=n.r,r.p=n.p,r.v=n.v),r};function xe(e,t,n,r,i){let o=Oe(e,n);t=+t;let s=function(e,n,r){return i(function(e){return a===typeof e?e:a===typeof(null==e?void 0:e.length)?e.length:null!=e&&f===typeof e?P(e).length:NaN}(e),t,e,n,r)};return Object.defineProperty(s,l,{value:r}),s.n=r,s.a=[t],s.s=()=>r+"("+t+")",s[Symbol.for("nodejs.util.inspect.custom")]=s.s(),s.toJSON=()=>s.s(),o.b.push(s),o}const we=function(e,t){return xe(this,e,t,"Min",(e,t,n,r,i)=>{if(t<=e)return!0;i.checkargs={min:1};let o=a===typeof n?"":"length ";return r.err=Ne(i,`Value "$VALUE" for property "$PATH" must be a minimum ${o}of ${t} (was ${e}).`),!1})},Ie=function(e,t){return xe(this,e,t,"Max",(e,t,n,r,i)=>{if(e<=t)return!0;let o=a===typeof n?"":"length ";return r.err=Ne(i,`Value "$VALUE" for property "$PATH" must be a maximum ${o}of ${t} (was ${e}).`),!1})},Ae=function(e,t){return xe(this,e,t,"Above",(e,t,n,r,i)=>{if(t<e)return!0;let o=a===typeof n?"be":"have length";return r.err=Ne(i,`Value "$VALUE" for property "$PATH" must ${o} above ${t} (was ${e}).`),!1})},je=function(e,t){return xe(this,e,t,C,(e,t,n,r,i)=>{if(e<t)return!0;let o=a===typeof n?"be":"have length";return r.err=Ne(i,`Value "$VALUE" for property "$PATH" must ${o} below ${t} (was ${e}).`),!1})},Se=function(e,t){return xe(this,e,t,C,(e,t,n,r,i)=>{if(t===e)return!0;let o=a===typeof n?"":" in length";return r.err=Ne(i,`Value "$VALUE" for property "$PATH" must be exactly ${t}${o} (was ${e}).`),!1})};function Oe(e,t){let n,r=null!=e&&(e.window===e||e.global===e);if(void 0!==e&&!r||void 0===t)if(void 0===e||r)n=K(void 0);else if(void 0!==t){n=K(t);let r=K(e);void 0===n.v&&"list"!==n.t&&(n.v=r.v,n.t=r.t),["f","r","p","c","e","z"].map(e=>n[e]=void 0!==r[e]?r[e]:n[e]),n.u=Object.assign({...r.u},n.u),n.m=Object.assign({...r.m},n.m),n.a=r.a.concat(n.a),n.b=r.b.concat(n.b)}else n=K(e);else n=K(t);return n.Above?n:Object.assign(n,{Above:Ae,After:de,Any:ie,Before:fe,Below:je,Check:pe,Child:be,Closed:ve,Default:ae,Define:ge,Empty:ue,Exact:he,Fault:oe,Ignore:se,Len:Se,Max:Ie,Min:we,Never:ce,Open:re,Refer:ye,Rename:me,Required:ne,Rest:$e,Skip:le,Type:ke})}function Ne(e,t,n,r){return Ce(n||k,e,4e3,t,r)}function Ce(e,t,n,r,i,o){var l;let h={key:t.key,type:t.node.t,node:t.node,value:t.val,path:ee(t),why:e,check:(null===(l=t.check)||void 0===l?void 0:l.name)||"none",args:t.checkargs||{},mark:n,text:"",use:i||{}},v=te((void 0===t.val?p:Ve(t.val)).replace(/"/g,""));if(null==(r=r||t.node.z)||""===r){let n=v.startsWith("[")?c:v.startsWith("{")?f:null==t.val||a===typeof t.val&&isNaN(t.val)?"value":typeof t.val,r=v.startsWith("[")||W(t.parents[t.pI])?"index":"property",l="is",p=null==i?void 0:i.k;p=W(p)?(r=1<p.length?(l="are","properties"):r,p.join(", ")):p,h.text="Validation failed for "+(0<h.path.length?`${r} "${h.path}" with `:"")+`${n} "${v}" because `+(b===e?y===t.node.t?`the ${n} is not an instance of ${t.node.u.n}`:`the ${n} is not of type ${x===t.node.t?d:t.node.t}`:u===e?""===t.val?"an empty string is not allowed":`the ${n} is required`:"closed"===e?`the ${r} "${p}" ${l} not allowed`:x===e?"the string did not match "+t.node.v:s===e?"no value is allowed":`check "${null==o?e:o}" failed`)+(h.use.thrown?" (threw: "+h.use.thrown.message+")":".")}else h.text=r.replace(/\$VALUE/g,v).replace(/\$PATH/g,h.path);return h}function Te(e){var t;let n=e.t;const r={number:I,string:w,boolean:A};if(r[n]){let t="";return e.r&&(t+=r[n]),""===t&&(t=JSON.stringify(e.v)),t+=e.b.map(t=>t.s?"."+t.s(e):"").join(""),t}if(v===n){let n="";return e.r&&(n+="Required"),v==(null===(t=e.c)||void 0===t?void 0:t.t)&&(n+=(""===n?"":".")+R),n+=e.b.map(t=>t.s?"."+t.s(e):"").join(""),n.startsWith(".")&&(n=n.slice(1)),""===n&&(n="Any"),n}if(k===n){let t="";return t+=e.b.map(t=>t.s?"."+t.s(e):"").join(""),t.startsWith(".")&&(t=t.slice(1)),t}if(f===n){let t={};for(let n in e.v)t[n]=Te(e.v[n]);return void 0!==e.c&&(r[e.c.t]?t.$$=V+"("+r[e.c.t]+")":"any"===e.c.t?t.$$=R:(t.$$=V+"($$child)",t.$$child=Te(e.c))),0<e.b.length&&(void 0===t.$$&&(t.$$=""),t.$$+=e.b.map(t=>t.s?"."+t.s(e):"").join(""),t.$$.startsWith(".")&&(t.$$=t.$$.slice(1))),t.$$&&1===Object.keys(t).length&&t.$$.startsWith(V)?t.$$:t}if(g===n){let t={},n=0,r=e.u.list.map(e=>Te(e)).map((e,r)=>f===typeof e?(t[r="$$ref"+n++]=e,r):e),i=(e.b[0].n||e.b[0].name)+"("+r.join(",")+")";return 0===n?i:{$$:i,...t}}if(c===n){let t=[];return void 0!==e.c?t[0]=Te(e.c):t=Object.keys(e.v).reduce((t,n)=>(t[+n]=e.v[n],t),[]).map(e=>Te(e)),t}if(x===n)return e.v.toString()}function Ve(e,t,r,i){let s;if(!i&&e&&e.$&&(n===e.$.gubu$||!0===e.$.gubu$))return e=JSON.stringify(Te(e)),r&&(e="string"==typeof e?e.replace(/\\/g,"").replace(/"/g,""):""),e;try{s=F(e,(e,l)=>{var s,a,u;if(t&&(l=t(e,l)),null!=l&&f===typeof l&&l.constructor&&j!==l.constructor.name&&S!==l.constructor.name)l="[object RegExp]"===o.call(l)||h===typeof l.toString?l.toString():l.constructor.name;else if(i||n!==(null===(s=null==l?void 0:l.$)||void 0===s?void 0:s.gubu$))if(h===typeof l)l=h===typeof Q[l.name]&&isNaN(+e)?void 0:null!=l.name&&""!==l.name?l.name:te(l.toString().replace(/[ \t\r\n]+/g," "));else if("bigint"==typeof l)l=String(l.toString());else{if(Number.isNaN(l))return"NaN";!0===i||!0!==(null===(a=null==l?void 0:l.$)||void 0===a?void 0:a.gubu$)&&n!==(null===(u=null==l?void 0:l.$)||void 0===u?void 0:u.gubu$)||(l=JSON.stringify(Te(l)))}else"number"===l.t||"string"===l.t||"boolean"===l.t?l=l.v:(l=Te(l),l=JSON.stringify(l),r&&(l="string"==typeof l?l.replace(/\\/g,"").replace(/"/g,""):""));return l}),s=String(s)}catch(l){s=F(String(e))}return!0===r&&(s=s.replace(/^"/,"").replace(/"$/,"")),s}function Ee(e){return null==e||f!==typeof e?e:B(F(e))}const Re={Above:Ae,After:de,All:function(...e){const t=Oe(this);t.t=g,t.r=!0;const n=e.map(e=>_e(e));t.u.list=n.map(e=>e.node());const r=function(t,r,i){let o=!0;for(let e of n){let n={...i.ctx,err:[]};e(t,n),0<n.err.length&&(o=!1)}return o||(r.why="All",r.err=[Ne(i,N+" "+G+D+M+" does not satisfy all of: "+e.map(e=>Ve(e,null,!0)).join(", "))]),o};return r.n="All",r.a=e,t.b.push(r),t},Any:ie,Before:fe,Below:je,Check:pe,Child:be,Closed:ve,Default:ae,Define:ge,Empty:ue,Exact:he,Fault:oe,Func:function(e){let t=Oe(this);return t.t=h,t.v=e,t.f=e,t},Ignore:se,Key:function(e,t){let n=Oe(this),r=a===typeof e;n.t=d,r&&null==t&&(n=K([]));let i=null;return h===typeof e&&(i=e,n=ie()),n.b.push((function(n,o,l){if(i)o.val=i(l.path,l);else if(r){let n=e;o.val=l.path.slice(l.path.length-1-(0<=n?n:0),l.path.length-1+(0<=n?0:1)),d===typeof t&&(o.val=o.val.join(t))}else null==e&&(o.val=l.path[l.path.length-2]);return!0})),n},Len:Se,Max:Ie,Min:we,Never:ce,One:function(...e){let t=Oe(this);t.t=g,t.r=!0;let n=e.map(e=>_e(e));t.u.list=n.map(e=>e.node());const r=function(t,r,i){let o=0;for(let e of n){let n={...i.ctx,err:[]};if(e.match(t,n)){o++,r.val=e(t,n);break}}return 1!==o&&(r.why="One",r.err=[Ne(i,N+" "+G+D+M+" does not satisfy one of: "+e.map(e=>Ve(e,null,!0)).join(", "))]),!0};return r.n="One",r.a=e,t.b.push(r),t},Open:re,Optional:function(e){let t=Oe(this,e);return t.r=!1,void 0===e&&1===arguments.length&&(t.t=p,t.v=void 0),t},Refer:ye,Rename:me,Required:ne,Skip:le,Some:function(...e){let t=Oe(this);t.t=g,t.r=!0;let n=e.map(e=>_e(e));t.u.list=n.map(e=>e.node());const r=function(t,r,i){let o=!1;for(let e of n){let n={...i.ctx,err:[]},l=e.match(t,n);l&&(r.val=e(t,n)),o||(o=l)}return o||(r.why=_,r.err=[Ne(i,N+" "+G+D+M+" does not satisfy any of: "+e.map(e=>Ve(e,null,!0)).join(", "))]),o};return r.n=_,r.a=e,t.b.push(r),t},Rest:$e,Type:ke};if(p!==typeof window)for(let Me in Re)J(Re[Me],l,{value:Me});Object.assign(Q,{Gubu:Q,...Re,...Object.entries(Re).reduce((e,t)=>(e["G"+t[0]]=t[1],e),{}),isShape:e=>e&&r===e.gubu,G$:e=>K({...e,$:{gubu$:!0}}),buildize:Oe,makeErr:Ne,stringify:Ve,truncate:te,nodize:K,expr:X,build:function e(t,n={},r=!0){let i;const o=Array.isArray(t)?"array":null===t?"null":typeof t;return"string"===o?i=X(t):"number"===o||"boolean"===o?i=t:f===o?i=Object.entries(t).reduce((t,r)=>{var i;return t[r[0]]=((null===(i=n.valexpr)||void 0===i?void 0:i.keymark)||"$$")===r[0]?r[1]:e(r[1],n,!1),t},{}):c===o&&(i=t.map(t=>e(t,n,!1))),r?(n.valexpr=n.valexpr||{},n.valexpr.active=!0,_e(i,n)):i},MakeArgu:function(e){return function(t,n,r){let i=!1;d===typeof t&&(i=!0,r=n,n=t);const o=_e(r=r||n,{name:e+(n=d===typeof n?" ("+n+")":"")}),l=o.node(),s=l.k;let a=t,u={},c=0,h=0;for(;c<s.length;c++){let e=l.v[s[c]];e.p&&(e=l.v[s[c]]=(t=>de((function(e,n,r){if(0<r.curerr.length){h++;for(let e=s.length-1;e>t;e--)l.v[s[e]].m.rest?u[s[e]].splice(l.v[s[e]].m.rest_pos+t-e,0,u[s[e-1]]):(r.vals[r.pI+e-t]=r.vals[r.pI+e-t-1],u[s[e]]=u[s[e-1]]);n.uval=void 0,n.done=!1}return!0}),e))(c),e.e=!1),c!==s.length-1||l.v[s[c]].m.rest||(l.v[s[c]]=de((function(e,t,n){return!(s.length-h<a.length&&(0===n.curerr.length&&(t.err=`Too many arguments for type signature (was ${a.length}, expected ${s.length-h})`),t.fatal=!0,1))}),l.v[s[c]]))}function f(e){for(let t=0;t<s.length;t++){let n=l.v[s[t]];n.m.rest?(u[s[t]]=[...e].slice(t),n.m.rest_pos=u[s[t]].length):u[s[t]]=e[t]}return u}return i?function(e){return a=e,u={},c=0,h=0,o(f(e))}:o(f(t))}}}),J(Q,l,{value:"gubu"});const _e=Q;t.Gubu=_e;const{Gubu:De}=t;return De}))}).call(this)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{}),g=g.exports;var y={exports:{}};(function(e){(function(){!function(t){"object"==typeof y.exports?y.exports=t():("undefined"!=typeof window?window:void 0!==e?e:"undefined"!=typeof self?self:this).Carn=t()}((function(){var e={};Object.defineProperty(e,"__esModule",{value:!0}),e.Carn=void 0;class t{constructor(e){this.start=-1,this.finish=-1,this.errs=[],this.bail=!0,this.id=e,this.run=-1}error(e,t,...r){let i=new n(this.id,this.run,e,t,...r);if(this.errs.push(i),this.bail)throw i;return i}throw(e,t,...n){throw this.error(e,t,...n)}init(e){this.run=e,this.start=Date.now(),this.bail=!1}check(){return this.active()||this.throw("not_active")}active(){return 0<this.start&&this.finish<0}finished(){return 0<this.finish}}class n extends Error{constructor(e,t,r,i,...o){(o="string"==typeof i?[i,...o]:o&&"string"==typeof o[0]?o:[n.Code[r]||r,...o])[0]+=` [id=${e},run=${t}]`+(i?" {"+Object.keys(i).map(e=>e+":"+i[e])+"}":""),super(...o),this.code=r,this.cid=e,this.crun=t}}n.Code={not_active:"Carn instance is not active (call Carn.start())",already_started:"Carn instance is already started",invalid_depth:"Invalid depth (<0)"},e.Carn=class{constructor(){this.newline="\n",this.indent="  ",this.separator=",",this.dI=0,this.id=1e6*Math.random()|0,this.run=-1,this.s=[],this.ctx=new t(this.id)}start(){return-1==this.ctx.start||this.ctx.finished()?(this.s=[],this.run=1e6*Math.random()|0,this.ctx=new t(this.id),this.ctx.init(this.run)):this.ctx.error("already_started"),this.ctx}add(e){this.ctx.check(),"string"==typeof e&&this.s.push(e)}sep(){this.ctx.check(),this.s.push(new i(this.separator))}depth(e,t){if(this.ctx.check(),"number"==typeof e){let n=(t=null==t||!!t)?this.dI+e:e;n<0&&this.ctx.error("invalid_depth",{move:e,relative:t,depth:n}),this.dI=n,this.s.push(new r(this.dI,this.indent))}return this.dI}finish(){return this.ctx.check(),this.ctx.finish=Date.now(),this.ctx}src(){this.ctx.start<0&&this.ctx.throw("not_active");let e="";for(let t=0;t<this.s.length;t++){let n=t;this.s[n]instanceof r?(e=this.s[n].toString(),this.s[n]=""):(this.s[n+1]instanceof i&&(this.s[n+2]instanceof r||(this.s[n]+=this.s[n+1].toString()),this.s[n+1]="",t++),this.s[n]=e+this.s[n]+this.newline)}return this.s.join("")}inject(e,t,n){let r=this.src();r=r.startsWith("\n")?r:"\n"+r,r=r.endsWith("\n")?r:r+"\n";let i=n[0],o=n[1];const l=new RegExp(i+"START:"+t+o+".*?"+i+"END:"+t+o,"s");return e.replace(l,i+"START:"+t+o+r+i+"END:"+t+o)}};class r{constructor(e,t){this.depth=null==e||e<0?0:e,this.indent=t}toString(){return this.indent.repeat(isNaN(this.depth)?0:this.depth)}}class i{constructor(e){this.separator=e}toString(){return this.separator}}return e}))}).call(this)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{}),y=y.exports;var m={},b=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(m,"__esModule",{value:!0}),m.MarkerMap=m.GeneratorMap=m.GubuGen=void 0;const $=b({}),k={md:["\x3c!--","--\x3e"]};m.MarkerMap=k;const x={"options~md":function(e,t){var n;t.start(),t.add("## Options");let r=[];if(e(void 0,{err:!1,log:(e,t)=>{if("kv"===e&&"string"==typeof t.key){let e=t.path.slice(1,t.dI+1),n=e.join("."),i=t.node,o=t.key;r.push({path:n,parts:e,node:i,key:o})}}}),0<r.length){r=r.sort((e,t)=>e.path<t.path?-1:e.path>t.path?1:0);let e=1;for(let i of r){let{path:r,parts:o,node:l,key:s}=i,a=l.t,u=l.r,c=l.v,h=(null===(n=l.m)||void 0===n?void 0:n.short)||s,f=o[o.length-1];for(;e<o.length;)t.add(`* _${o[e-1]}_`),t.depth(1),e++;for(;o.length<e;)t.depth(-1),e--;t.add(`* _${f}_: \`${a}\` ${u?"(required)":"(default: "+c+")"} - ${h}`)}}else t.add("_None_")}};m.GeneratorMap=x,m.GubuGen=class{constructor(){}generate(e){let t=function(e,t){let n=e.generator,r=e.format,i=x[n+"~"+r];if(null===i){let t=`Cannot find generator ${e.generator} for format ${e.format}`;throw new Error(t)}return i}(e);const n=new y.Carn;t(e.shape,n);let r=(i=e.target,$.default.readFileSync(i).toString());var i;let o=n.inject(r,e.generator,k[e.format]);return function(e,t){$.default.writeFileSync(e,t)}(e.target,o),n}};var w={},I=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(w,"__esModule",{value:!0}),w.JsonicDoc=void 0;const A=I(v);class j{constructor(e,t){this.spec=e;try{const e=require(this.spec.folder),n=(e.meta||{}).name||this.spec.name;this.plugin=e[n],null==this.plugin&&(this.plugin=e[this.spec.name[0].toUpperCase()+this.spec.name.substring(1)]),null==this.plugin&&t.errs.push("No plugin found for name: "+this.spec.name+" in package at: "+this.spec.folder)}catch(n){t.errs.push(n.message)}}genOptionsMD(){const e=this.plugin.defaults,t=(0,g.Gubu)(e),n=A.default.join(this.spec.folder,"README.md");(new m.GubuGen).generate({shape:t,generator:"options",format:"md",target:n})}}return w.JsonicDoc=j,j.defaults={folder:"",name:""},w}));